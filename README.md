# Отчет по выполнению тестового задания

## Титульная страница

**Бушмелев Константин**  
Тестовое задание на стажировку в Авито  
Весна 2025

---

## Инструкция по развертыванию проекта

### Подготовка

1. Убедитесь, что на машине установлены:
   - Docker и Docker Compose
   - Java 17+
   - Gradle (или используйте `./gradlew`)

2. Создайте файл `src/main/resources/secrets.properties` со следующим содержимым (тестовым):

```
JWT_SECRET=d14295a6f2240f686c47c0e217ec615231059afbb269f6a65da052d79ecc7fb1
JWT_EXPIRATIONS=86400
DB_URL=jdbc:postgresql://localhost:5434/mydb
DB_USERNAME=dbuser
DB_PASSWORD=dbpassword
```

### Docker Compose

Файл `docker-compose.yml`:

```yaml
services:
  db:
    image: postgres:15
    container_name: db-pvz
    environment:
      - POSTGRES_DB=mydb
      - POSTGRES_USER=dbuser
      - POSTGRES_PASSWORD=dbpassword
    ports:
      - "5434:5432"
    volumes:
      - db-pvz-data:/var/lib/postgresql/data
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U dbuser -d mydb" ]
      interval: 5s
      timeout: 1s
      retries: 10
    restart: unless-stopped

volumes:
  db-pvz-data:
```

Запустите базу данных:

```bash
docker-compose up -d
```

### Запуск приложения

```bash
./gradlew bootRun
```

Swagger UI будет доступен по адресу:  
[http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

---

## Описание сервиса

Сервис предназначен для учета поставок товаров в пункты выдачи заказов (ПВЗ).

На ПВЗ несколько раз в день привозят новые товары, заказанные пользователями Авито. Прежде чем их передать получателям, необходимо провести приемку — проверить содержимое поставки и внести информацию в базу данных.

Так как ПВЗ много, а поставок ещё больше, сервис позволяет отслеживать:

- Сколько приемок поступало на каждый ПВЗ в течение дня
- Какие товары были приняты
- Кто из сотрудников проводил приемку

Также реализована авторизация и разграничение прав пользователей.

---

## Ход выполнения работы

### Генерация моделей и контроллеров

В начале работы использована спецификация OpenAPI (`swagger.yaml`) для генерации:

- DTO
- REST-контроллеров

Кодгенерация прошла успешно, требовалась минимальная ручная корректировка.

### Аутентификация и авторизация

Реализована полноценная система авторизации:

- Пользователи могут регистрироваться и входить в систему (`/auth/register`, `/auth/login`)
- Используется Spring Security
- Аутентификация осуществляется через JWT
- Поддерживаются роли:
  - `CLIENT`
  - `EMPLOYEE`
  - `MODERATOR`

После входа токен можно вставить в Swagger через кнопку **Authorize**.

### Работа с базой данных

- Используется PostgreSQL (разворачивается через Docker Compose)
- Для доступа используется Spring Data JDBC
- Hibernate/ORM не используется, поэтому:
  - Сущности и связи прописывались вручную
  - Дополнительная работа с SQL-скриптами

Модели проекта:

- `User` — зарегистрированный пользователь
- `Pvz` — пункт выдачи заказов
- `Reception` — приёмка на ПВЗ
- `Product` — товар, связанный с приемкой

Также реализованы необходимые перечисления (`enum`) для статусов и ролей.

### Логика приложения

- Возможность открыть новую приёмку на ПВЗ
- Приёмка может быть только одна на момент времени
- Возможность закрыть последнюю активную приёмку
- Валидации: нельзя создать вторую активную приёмку

Бизнес-логика реализована через сервисы, репозитории и REST-контроллеры.

### Swagger и тестирование

Swagger UI настроен и доступен по порту `8080`. Через него можно:

- Регистрироваться
- Входить в систему
- Осуществлять действия с приемками и товарами
- Тестировать авторизацию

Все эндпоинты документированы и готовы к ручному тестированию.

---

## Проблемы и особенности

- **Отказ от Hibernate**: работа через Spring Data JDBC потребовала ручной настройки всех связей и маппинга.
- **OpenAPI**: наличие схемы упростило старт проекта.
- **Ручное создание скриптов**: пришлось писать SQL вручную, особенно при инициализации структуры БД.

---

## Генерация кода по OpenAPI

Для генерации моделей и контроллеров используется:

```bash
./gradlew openApiGenerate
```

---

## Выполненные требования

- Генерация и правка DTO и контроллеров
- Авторизация и роли через Spring Security + JWT
- PostgreSQL и Spring Data JDBC
- Бизнес-логика приема товаров
- Swagger UI для ручного тестирования
- Docker Compose для базы данных
- Генерация кода по OpenAPI

---

## Обратная связь

Буду рад фидбеку по работе и любым рекомендациям по улучшению проекта!
